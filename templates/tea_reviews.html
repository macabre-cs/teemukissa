<!DOCTYPE html>
<html>
  <head>
    <title>{{ tea_variety.capitalize() }} arvostelut</title>
    <link rel="stylesheet" href="/static/main.css" />
  </head>
  <body>
    <div class="header">
      <h1>{{ tea_variety.capitalize() }} arvostelut</h1>
    </div>
    <nav class="nav">
      <a href="/teatimes">Teehetket</a> |
      <a href="/add_review">Lisää teehetki</a> |
      <a href="/search">Haku</a> |
      <a href="/">Etusivu</a> | 
      {% if session.user_id %}
      <a href="/logout">Kirjaudu ulos</a> |
      <a href="/user/{{ session.user_id }}">Oma profiili</a>
      {% else %}
      <a href="/login">Kirjaudu sisään</a>
      {% endif %}
    </nav>

    {% for message in get_flashed_messages() %}
    <div class="message">{{ message }}</div>
    {% endfor %}

    {% if reviews %} {% for review in reviews %}
    <div class="review">
      <h3><a href="/review/{{ review.id }}">{{ review.title | show_lines }}</a></h3>
      <p>
        <strong><a href="/user/{{ review.user_id }}">{{ review.username }}</a>:</strong>
        {{ review.content | show_lines }}
        <em>({{ review.sent_at }})</em>
      </p>

      {% if review.rating %}
      <p>Tassuarvosana: {{ review.rating }}</p>
      {% endif %}

      <div class="actions">
        {% if review.user_id == session["user_id"] %}
        <a href="/edit/{{ review.id }}">Muokkaa</a> |
        <a href="/remove/{{ review.id }}">Poista</a>
        {% endif %}
      </div>

      {% if comments[review['id']] %}
      <div class="comments">
        <h4>Komentit:</h4>
        <ul>
          {% for comment in comments[review['id']] %}
          <li class="comment">
            <strong><a href="/user/{{ comment.user_id }}">{{ comment.username }}</a>:</strong>
            {{ comment.content | show_lines }}
            <em>({{ comment.sent_at }})</em>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      <form action="/add_comment" method="POST" class="create-review">
        <input type="hidden" name="review_id" value="{{ review['id'] }}" />
        <input type="hidden" name="source" value="tea" />
        <textarea name="content" rows="2" maxlength="1000" required placeholder="Kirjoita kommenttisi tähän..."></textarea><br />
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
        <input type="submit" value="Lisää kommentti" />
      </form>
    </div>
    {% endfor %} {% else %}
    <p>Ei vielä arvosteluita tälle teelle!</p>
    {% endif %}

    <div class="create-review">
      <h2>Lisää arvostelu teelle :3</h2>
      <form action="/add_review" method="POST">
        <input type="hidden" name="variety" value="{{ tea_variety }}" required />

        <h4>Arvostelun otsikko:</h4>
        <input type="text" name="title" maxlength="80" required placeholder="Kirjoita arvostelun otsikko" />

        <h4>Tassuarvosana:</h4>
        {% for i in range(1, 6) %}
        <label> <input type="radio" name="rating" value="{{ i }}" required /> {{ i }} </label>
        {% endfor %}

        <textarea name="content" rows="4" maxlength="5000" required placeholder="Kirjoita arvostelusi tähän mau! :3"></textarea><br />
        <input type="hidden" name="csrf_token" value="{{ session.csrf_token }}" />
        <input type="submit" value="Lähetä :3" />
      </form>
    </div>
  </body>
</html>
